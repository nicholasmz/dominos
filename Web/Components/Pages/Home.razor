@page "/home"
@using Logic
@inject GameSession GameSessionService
@implements IDisposable

<h3>Connect 4 Multiplayer</h3>

<div class="game-board">
    @for (int row = 0; row < 6; row++)
    {
        <div class="row">
            @for (int col = 0; col < 7; col++)
            {
                <button class="cell" @onclick="() => MakeMove(col)">
                    @(GameSessionService.CurrentGame.Board[row, col] == 0 ? "" : GameSessionService.CurrentGame.Board[row, col] == 1 ? "❄️" : "🔥")
                </button>
            }
        </div>
    }
</div>

@if (!string.IsNullOrEmpty(GameSessionService.CurrentGame.GameOverMessage))
{
    <div class="alert alert-success">@GameSessionService.CurrentGame.GameOverMessage</div>
}

<button @onclick="StartNewGame">Start New Game</button>

@code {
    protected override void OnInitialized()
    {
        GameSessionService.CurrentGame.OnChange += StateHasChanged;
    }

    private void StartNewGame()
    {
        GameSessionService.CurrentGame.Reset();
    }

    private void MakeMove(int column)
    {
        GameSessionService.MakeMove(column);
    }

    public void Dispose()
    {
        GameSessionService.CurrentGame.OnChange -= StateHasChanged;
    }
}
