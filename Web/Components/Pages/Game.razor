@page "/game/{GameId}"
@using Logic
@inject NavigationManager Navigation

<h3>Connect 4 Game</h3>

@if (CurrentSession == null)
{
    <div class="alert alert-danger">
        <p>The session is invalid or has ended. Please return to the lobby.</p>
        <a href="/lobby" class="btn btn-primary">Go to Lobby</a>
    </div>
}
else
{
    <h4>Player 1: @CurrentSession.Player1.Name vs Player 2: @CurrentSession.Player2?.Name</h4>

    <div class="game-board">
        @for (int row = 0; row < 6; row++)
        {
            <div class="row">
                @for (int col = 0; col < 7; col++)
                {
                    <button class="cell" @onclick="() => MakeMove(col)">
                        @(CurrentSession.CurrentGame.Board[row, col] == 0 ? "" :
                          CurrentSession.CurrentGame.Board[row, col] == 1 ? "ðŸ”´" : "ðŸ”µ")
                    </button>
                }
            </div>
        }
    </div>

    @if (!string.IsNullOrEmpty(CurrentSession.CurrentGame.GameOverMessage))
    {
        <div class="alert alert-success">@CurrentSession.CurrentGame.GameOverMessage</div>
        <a href="/lobby" class="btn btn-primary">Return to Lobby</a>
    }
}

@code {
    [Parameter] public string GameId { get; set; } = string.Empty;
    private GameSession? CurrentSession => GameService.LobbyGames.FirstOrDefault(g => g.SessionId == GameId);

    private void MakeMove(int column)
    {
        if (CurrentSession != null)
        {
            CurrentSession.MakeMove(column);
        }
    }
}
